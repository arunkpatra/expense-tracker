<html lang="en" xmlns="http://www.w3.org/1999/xhtml" 
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:h="http://java.sun.com/jsf/html" 
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui" 
	xmlns:sec="http://www.springframework.org/security/tags"
	xmlns:f="http://java.sun.com/jsf/core">	
<ui:composition template="/layouts/standard.xhtml">

	<ui:define name="body">
		<h:form id="modifyUser">
			<h2>Modify User</h2>
			<div id="messagesInsertionPoint">
				<h:messages errorClass="errors" />
			</div>
			<p:fieldset>
				<div class="field">
					<div class="label">
						<h:outputLabel for="userName">User Name:</h:outputLabel>
					</div>
					<div class="output">
						<h:outputText id="userName"
							value="#{selectedUserToBeModified.username}" required="true" />
					</div>
				</div>
				<div class="field">
					<div class="label">
						<h:outputLabel for="emailId">Email Id:</h:outputLabel>
					</div>
					<div class="input">
						<h:inputText id="emailId"
							value="#{selectedUserToBeModified.emailId}" required="false"
							maxlength="32" />
					</div>
				</div>
				<div class="field">
					<div class="label">
						<h:outputLabel for="firstName">First Name:</h:outputLabel>
					</div>
					<div class="input">
						<h:inputText id="firstName"
							value="#{selectedUserToBeModified.firstName}" required="true"
							maxlength="16" />
					</div>
				</div>
				<div class="field">
					<div class="label">
						<h:outputLabel for="lastName">Last Name:</h:outputLabel>
					</div>
					<div class="input">
						<h:inputText id="lastName"
							value="#{selectedUserToBeModified.lastName}" required="true"
							maxlength="16" />
					</div>
				</div>
				<div class="field">
					<div class="label">
						<h:outputLabel for="middleInit">Middle Init:</h:outputLabel>
					</div>
					<div class="input">
						<h:inputText id="middleInit"
							value="#{selectedUserToBeModified.middleInit}" required="false"
							maxlength="1" size="2" />
					</div>
				</div>
				<div class="field">
					<div class="label">
						<h:outputLabel for="enabled"
							rendered="#{selectedUserToBeModified.username ne currentUser.name}">Enabled:</h:outputLabel>
					</div>
					<div class="input">
						<h:selectBooleanCheckbox id="enabled"
							value="#{selectedUserToBeModified.enabled}"
							rendered="#{selectedUserToBeModified.username ne currentUser.name}" />
					</div>
				</div>
				<div class="buttonGroup">
					<p:commandButton id="back" value="Back" action="back"
						process="@form" />
					<p:commandButton id="updateUser" value="Save" process="@form"
						action="updateUser" oncomplete="saveConfirmDialog.show()"/>
					<p:commandButton id="cancel" value="Cancel" process="@form"
						action="cancel" />
				</div>
			</p:fieldset>
			<p:dialog widgetVar="saveConfirmDialog" 
				header="User Modification" modal="true" width="300">
				<p:outputPanel id="updateContent">
					<span class="errors"> <h:messages globalOnly="true" />
					</span>
					<p>The user was updated successfully.</p>
					<p:commandButton id="updateOk" value="Ok" action="updateOk"/>
				</p:outputPanel>
			</p:dialog>
		</h:form>
		<h:form id="modifyAuths">
			<p:fieldset id="roleList">
				<h:outputText id="noRolesText" value="No roles found for this user"
					rendered="#{userAuths.rowCount == 0}" />
				<h:dataTable id="auths" styleClass="summary" value="#{userAuths}"
					var="a" rendered="#{userAuths.rowCount > 0}">
					<h:column>
						<f:facet name="header">
							<h:outputText value="Authorization" />
						</f:facet>
									#{a.authority}			
								</h:column>
					<h:column>
						<f:facet name="header">
							<h:outputText value="Action">
							</h:outputText>
						</f:facet>
						<p:commandButton id="deleteAuth" value="Delete"
							action="deleteAuth" oncomplete="confirmDialog.show()">
							<f:param name="authIdToDelete" value="#{a.id}" />
						</p:commandButton>
					</h:column>
				</h:dataTable>
				<p:commandButton id="addAuth" value="Add New Role" process="@form"
					action="addAuth">
					<f:param name="selectedUserName" value="#{selectedUser.username}"></f:param>
				</p:commandButton>
			</p:fieldset>
			<p:dialog widgetVar="confirmDialog" id="dlg1"
				header="Authorization deletion result" modal="true" width="300">
				<p:outputPanel id="confirmContent">
					<span class="errors"> <h:messages globalOnly="true" />
					</span>
					<p>The role was deleted successfully.</p>
					<p:commandButton id="ok" value="Ok" action="deleteAuthOk"
						update="roleList" />
				</p:outputPanel>
			</p:dialog>
		</h:form>
	</ui:define>
</ui:composition>
</html>